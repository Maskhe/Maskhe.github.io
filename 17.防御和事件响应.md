# 执行事件管理

## 定义事件

一般来说，事件是指对组织资产的机密性、内部性或可用性产生负面影响的任何事件。

相比之下，计算机安全事件（有时简称为安全事件）通常是指由**攻击或用户恶意或故意行为导致的事件。**

美国国家标准与技术研究院 （NIST） 特别出版物 （SP） 800-61《计算机安全事件处理指南》将计算机安全事件定义为“**违反计算机安全策略、可接受使用策略或标准安全实践的冲突或迫在眉睫的威胁**“。
## 事件管理流程

![](attachments/Pasted%20image%2020241218170146.png)


**检测（Dectection）**：入侵检测系统、反病毒软件以及其他自动化工具，或者终端用户地反馈
**响应（Response）**：计算机事件响应团队（CIRT），计算机安全事件响应团队（CSIRT）对事件进行调查（investigation），越快的响应对应着越小的损失，调查结束后，可能会对相关责任人追责，所以保留证据是非常重要的。当事件发生时，一定不要关闭计算机，因为RAM中可能存在很重要的证据，需要先拷贝出来。
**缓解（Mitigation）**：缓解是尽最大可能把实践的影响范围降到最小。
**报告**：想管理层或者外部监管机构报告事件。小（minor）的事件可以不报告，但是严重的事件一定要报告。PCI DSS对相关机构发生事件后需要提交报告是有明确要求的。
**恢复（Recovery）**：将系统恢复到没有被攻击的状态
**修复（Remediation）**：执行根因分析（root cause analysis），搞清楚什么导致了事件发生，并修复相关问题。
**吸取经验教训**：时间响应流程是否正常？此类问题以后能否及时检测？

**注意：不能向攻击者发起攻击**
# 实施检测和防御措施

- **检测型控制（Detective Control）**：侦探控制尝试发现或检测不需要的或未经授权的活动。检测型控制在事后运行，只有在活动发生后才能发现活动
- **防御型控制（Preventive Control）**：预防性控制试图阻止或阻止不需要的或未经授权的活动的发生。预防性控制的示例包括围栏、锁、生物识别、职责分离策略、工作轮换策略、数据分类、访问控制方法、加密、智能卡、回调过程、安全策略、安全意识培训、防病毒软件、防火墙和入侵防御系统。

## 常见的阻止、防御措施

- 使系统和应用程序保持最新状态
- 删除或禁用不需要的服务和协议
- 使用入侵检测和防御系统
- 使用最新的反恶意（antimalware）软件
- 使用防火墙
- 实施配置和系统管理流程

## 理解攻击

僵尸网络：

拒绝服务攻击：

SYN洪水攻击：

![](attachments/Pasted%20image%2020241218171212.png)


**TCP重置攻击**：通过发送一个带有RST标志位的数据包，并伪造数据包的source ip，从而恶意中断某个tcp连接，如果两台主机正在发送数据，这种攻击会导致他们重新构造数据并发送，浪费资源。

**Smurf 和 Fraggle 攻击**：Smurf 和 fraggle 攻击都是 DoS 攻击。
	- Smurf攻击：Ping 使用 ICMP 检查与远程系统的连接。通常，ping 会向单个系统发送 echo 请求，而系统会以 echo 回复进行响应。但是，在 smurf 攻击中，攻击者将 echo 请求作为广播发送到网络上的所有系统，并欺骗源 IP 地址。所有这些系统都通过对欺骗性 IP 地址的回声回复来响应，从而向受害者发送大量流量。
	- Fraggle攻击：Fraggle 攻击类似于 Smurf 攻击。但是，fraggle 攻击不是使用 ICMP，而是使用 UDP 端口 7 和 19 上的 UDP 数据包。fraggle 攻击将使用受害者的欺骗性 IP 地址广播 UDP 数据包，然后，网络上的所有系统都会将流量发送给受害者，就像 smurf 攻击一样。fraggle 攻击的一个变体是使用随机 UDP 端口的 UDP 泛洪攻击

**ping洪水**：Ping 泛洪攻击会向受害者发送 ping 请求。当僵尸网络中的僵尸作为 DDoS 攻击发起时，这可能非常有效。如果数以万计的系统同时向系统发送 ping 请求，则系统在尝试响应 ping 请求时可能会不堪重负。受害者将没有时间回应合法请求。
**0day攻击**：
	- Attacker discovers a vulnerability first.
	- Vendor learns of vulnerability but hasn’t released a patch
	- Vendor releases patch and systems are attacked within 24 hours.

**中间人攻击**：略

**sabotage**：员工破坏（sabotage）是员工对组织实施的破坏或破坏犯罪行为。

**死亡之ping**（几乎无效了）：死亡 ping 攻击使用超大的 ping 数据包。一些操作系统无法处理它们。在某些情况下，系统崩溃，而在其他情况下，攻击会导致缓冲区溢出错误。

**泪滴攻击**(Teardrop，几乎失效了)：泪滴攻击会碎片化数据包，使其难以或不可能被接收系统重新组合在一起。这通常会导致系统崩溃。

**陆地**（land，几乎失效了）：在陆地攻击中，攻击使用 受害者 的 IP 地址作为源 IP 地址和目标 IP 地址，向受害者发送欺骗性的 SYN 数据包。一种变体是 banana 攻击，它将传出的消息从系统重定向回系统，从而关闭所有外部通信
## 入侵检测和阻止系统

**入侵检测系统（intrusion detection system）**：入侵检测系统 （IDS） 可自动检查日志和实时系统事件，以检测入侵尝试和系统故障。由于 IPS 包含检测功能，因此您经常会看到它们被称为入侵检测和防御系统 （IDPS）。

**入侵防御系统（intrusion prevention system）**：入侵防御系统 （IPS） 包括 IDS 的所有功能，但也可以采取其他措施来阻止或防止入侵。如果需要，管理员可以禁用 IPS 的额外功能，实质上是使其充当 IDS。

### 基于知识的检测和基于行为的检测：


True positive
False negative
False positive
True negative


### IDS 响应

**被动响应**：被动响应记录事件并发送通知

**主动响应**：主动响应除了记录事件发送通知外，还可以使用不同的方式修改当前环境。例如修改ACL策略去拦截特定流量。

### 基于主机和基于网络的IDS

监控加密的网络流量，很多流量都是使用https的，这就需要https解密器来解密https流量，通常的实现方式就是通过类似中间人的方式实现的。

如果流量在发送之前就经过加密了https解密器就起不到作用了。

### 入侵防御系统

A distinguishing difference between an NIDS and a network- based IPS (NIPS) is that the NIPS is placed inline with the traffic

![](attachments/Pasted%20image%2020250806142002.png)


## 具体的防御措施

### 蜜罐和蜜网

略

### 警告横幅

警告横幅告知用户和入侵者基本安全策略准则。最典型的案例就是各种18禁提示了吧。

### 反恶意软件

略

### 白名单和黑名单

略

### 防火墙

略

### 沙箱

沙盒为应用程序提供安全边界，并防止应用程序与其他应用程序交互。

安全研究员们通常使用沙盒技术来测试一些恶意软件，例如在一个虚拟机环境中运行恶意软件，观察它的特征。

### 第三方安全服务

将安全服务外包给第三方，例如审计和渗透测试等。

但是，在某些场景下，需要确认第三方符合某种要求，例如处理交易相关数据时，第三方就需要满足PCI DSS的要求。

# 日志和监控


## 日志技术

日志记录是将有关事件的信息记录到日志文件或数据库的过程。日志记录捕获事件、更改、消息和其他描述系统上活动的数据。日志通常会记录详细信息，例如发生了什么、何时发生、发生在何处、谁做了，有时还记录了如何发生

### 通用日志类型

**安全日志**：安全日志记录对 files 、 folders、printer等 资源的访问。例如，他们可以记录用户何时访问、修改或删除了某个 file。

**系统日志**：系统日志记录系统事件，例如系统启动或停止时、服务启动或停止时，或者修改服务属性时

**应用日志**：这些日志记录特定应用程序的信息。应用程序开发人员选择要在应用程序日志中记录的内容

**防火墙日志**：防火墙日志可以记录与到达防火墙的任何流量相关的事件

**代理日志**：代理服务器可以提高用户的 Internet 访问性能，并且可以控制用户可以访问的网站。代理日志包括记录详细信息的能力，例如特定用户访问了哪些网站以及他们在这些网站上花费了多少时间。

**变更日志**：更改日志记录整个更改管理流程中的更改请求、批准和对系统的实际更改

### 保护日志数据

1. 避免日志被未授权的删除和修改。
2. 日志的备份，存储时间等等。

如果组织遇到法律问题，保留不必要的日志可能会导致过多的人工成本。

Federal Information and Information Systems (FIPS 200)对审计数据的最小要求：

- 在必要的范围内创建、保护和保留信息系统审计记录，以便能够监视、分析、调查和报告非法、未经授权或不适当的信息系统活动
- 确保可以唯一地跟踪到这些用户的个人信息系统用户的行为，以便他们能够对自己的行为负责。

## 监控的作用

### 审计跟踪

审计跟踪（Audit Trails）是存储在一个或多个文件、数据库的事件记录。

### 监控和问责

监控是必要的，以确保主体（例如用户和员工）能够对他们的行为和活动负责

### 监控和调查

审计跟踪使调查人员能够在事件发生很久之后重建事件。他们可以记录访问滥用、权限侵犯、入侵企图和许多不同类型的攻击。

### 监控和问题识别

审计跟踪提供有关对管理员有用的记录事件的详细信息。除了恶意攻击之外，它们还可以记录系统故障、操作系统错误和软件错误

## 监控的技术

### SIEM

### Syslog

RFC 5424（Syslog 协议）描述了用于发送事件通知消息的 syslog 协议

### Sampling(取样)

采样或数据提取是从大量数据中提取特定元素以构建有意义的整体表示或摘要的过程。

**统计抽样（Statistical sampling）使用精确的数学函数从大量数据中提取有意义的信息，因此类似于民意调查人员用来了解大量人群的意见而不采访人群中的每个人的科学。抽样数据始终存在不能准确表示整个数据主体的风险，而统计抽样可以识别误差幅度**

统计抽样（statistical）和非统计抽样（nonstatistical）都是创建大量审计数据的摘要或概述的有效机制。然而，统计抽样更可靠，在数学上也更合理

### 剪切级别（clipping levels)

裁剪（clipping）是非统计采样的一种形式。它只选择超过 Clipping 级别（事件的预定义阈值）的事件。系统会忽略事件，直到它们达到此阈值。

### 其他监控工具 

击键监控（Keystroke）：击键监控是记录用户在物理键盘上执行的击键的操作。常常被攻击者用来窃取信息

流量分析和趋势分析（Traffic Analysis and Trend Analysis）：流量分析和趋势分析是检查数据包流而不是实际数据包内容的监控形式。这些过程有时称为网络流量监控。它可以推断出很多信息，例如主要和备用通信路由、主要服务器的位置、加密流量的来源和网络支持的流量、流量的典型方向、通信频率等等。

## 日志管理

日志管理设计日志的收集、处理和保护。

- SIEM
- rollover logging：当日志文件超过某个最大大小时，自动归档
## 出口监控（Egress Monitoring）

DLP

- **通过隐写术（steganography）外发数据，可以通过比较文件hash的方式来判断某个文件是否藏有数据。**
- **通过数字水印的方式追踪数据，DLP通过检测数字水印监控数据外发**

如果数据被加密后再发送，那么DLP系统可能无法探测具体发送的文件内容，但是可以知道有加密文件被发送了，从哪里发出，发向哪里，所以也可以做到告警。


# 自动事件响应

## 理解SOAR

安全编排、自动化和响应 （SOAR） 是指允许组织自动响应某些事件的一组技术

剧本（playbook）：
runbook：


## 机器学习和AI工具

关键点是机器学习是 AI 的子集。

机器学习往往需要一些基础规则作为输入，机器会随着各种行为的发生，逐渐优化这些规则。

而AI则不需要任何基础输入，它自动学习游戏规则，并优化。

## 威胁情报（Threat Intelligence）

### 理解 kill chain

军队的kill chain：

1. 通过侦察找到或识别目标。
2. 获取目标的位置。
3. 跟踪目标的移动。
4. 选择要对目标使用的武器。
5. 用选定的武器与目标交战。
6. 评估攻击的有效性。

一些组织在军队的kill chain基础上发展出了cybper kill chain：

1. 侦察（Reconnaissance）。攻击者收集有关目标的信息。
2. 武器化（Weaponization）。攻击者会识别目标容易受到攻击的漏洞，以及利用该漏洞的方法。
3. 投递（Delivery）。攻击者通过网络钓鱼攻击、恶意电子邮件附件、受感染的网站或其他常见的社会工程方法将武器发送给目标。
4. 利用（Exploitation）。该武器利用了目标系统上的漏洞。
5. 安装（Installation）。然后，利用此漏洞的代码会安装恶意软件。该恶意软件通常包括一个后门，允许目标远程访问系统。
6. 命令和控制（Command and Control）。攻击者维护一个命令和控制系统，该系统可以控制目标和其他受感染的系统。
7. 对目标的行动（Actions on objectives）。攻击者执行其最初的目标，例如盗窃金钱、盗窃数据、数据销毁或安装其他恶意代码，例如勒索软件。

通过破坏kill chain来防御攻击。

### 理解 MITRE ATT&CK

MITRE ATT&CK 矩阵（由 MITRE 创建，可在 attack.mitre.org 查看）是攻击者在各种攻击中使用的已识别策略（tactics）、技术（techniques）和程序（procedures） （TTP） 的知识库。

这个知识库还在保持更新。

### 威胁源（推送）

威胁源是与当前和潜在威胁相关的稳定原始数据流。但是，在其原始形式中，可能很难提取有意义的数据

以下是威胁情报源中包含的一些信息：

- 可疑域名
- 已知的恶意软件hash
- 在 Internet 站点上共享的代码
- 与恶意活动相关的 IP 地址

企业可以使用这些信息来比对出入站流量、主机文件，从而发现正在发生的攻击行为。

### 威胁狩猎

威胁搜寻是在网络中主动搜索网络威胁的过程。这不仅仅是等待传统网络工具检测和报告攻击。

通过已知的威胁信息，排查内网中是否有同样的特征，从而排查自己是否受到攻击。

例如，假设威胁源表明僵尸网络最近发起了多次 DDoS 攻击。它显示了用于将计算机连接到机器人网络的常用 TTP。此外，它还列出了识别加入此僵尸网络的计算机时要查找的具体内容。这可能是存在特定文件，或者显示进出网络的特定流量的日志条目。一旦管理员知道要查找的内容，就可以简单地编写脚本来在所有内部计算机上查找这些文件，或者为日志条目与威胁源信息匹配的任何网络流量发送警报。

一种流行的威胁搜寻方法是使用kill chain模型。
## SOAR、机器学习、AI 和威胁源的交集




-----


bcd
a
a   d
acde   acd
b

b
a
a
c
b  d

b
a
d
b
b

b
b
d
a
a
