# 灾难的本质

## 自然灾害

地震：

洪水：

飓风：

火灾：

流行病（Pandemics）：

其它自然事件：有些地区涉及一些特殊的自然灾害，例如火山喷发。

## 人为灾难

火灾：

恐怖主义行为：

**一般商业保险可能无法适当地涵盖组织免受恐怖主义行为的侵害**

炸弹/爆炸风险：

停电（power outages）：关键业务系统通常由不间断电源 （uninterruptible power supply，UPS） 设备提供保护，以保持其运行至少足够长的时间以关闭或足够长的时间以使应急发电机启动并工作。

网络，实用程序和基础设施故障：

硬件、软件故障：

罢工/纠察队：在设计业务连续性和灾难恢复计划时，不要忘记人为因素在应急计划中的重要性。一种经常被忽视的人为灾难形式是罢工或其他劳工危机的可能性

盗窃/故意破坏：

# 了解系统弹性、高可用性和容错能力

增加系统弹性和容错能力的技术控制直接影响可用性，这是 CIA 三元组的核心目标之一（机密性、完整性和可用性）。系统弹性和容错能力的主要目标是消除关键业务系统中的单点故障。

**单点故障（single point of failure，SPOF）**：单点故障 （SPOF） 是可能导致整个系统发生故障的任何组件。

**系统弹性（system resilience）**：是指系统在不良事件期间保持可接受的服务水平的能力。

**容错能力（fault tolerance）**：是指系统遭受故障但继续运行的能力。

**高可用（High availability）**：高可用性是指使用冗余技术组件，使系统能够在经历短暂中断后快速从故障中恢复

## 保护硬盘驱动器

为计算机添加容错能力和系统弹性的一种常见方法是使用 RAID 阵列。其中一个硬盘损坏，不会影响系统运行。一些通用的RAID配置如下：

- RAID-0：这也称为条带化（striping）。它使用两个或多个磁盘并提高磁盘子系统的性能，**但不提供容错能力**。
- RAID-1：这也称为镜像（mirroring）。它使用两个磁盘，这两个磁盘都保存相同的数据。如果一个磁盘发生故障，另一个磁盘将包含数据，以便系统可以在单个磁盘发生故障后继续运行。
- RAID-5：这也称为奇偶校验条带化（striping with parity）。它使用三个或更多磁盘，相当于一个磁盘保存奇偶校验信息。如果单个磁盘丢失，此奇偶校验信息允许通过数学计算重建数据。如果任何单个磁盘发生故障，RAID 阵列将继续运行，但速度会变慢
- RAID-6：这为具有奇偶校验的磁盘条带化提供了一种替代方法。它的功能与 RAID-5 相同，但将奇偶校验信息存储在两个磁盘上，防止两个独立磁盘发生故障，但至少需要四个磁盘才能实现
- RAID-10：这也称为 RAID 1 + 0 或镜像条带，它配置为两个或多个镜像 （RAID-1），每个镜像都配置在条带化 （RAID-0） 配置中。它至少使用 4 个磁盘，但只要添加偶数个磁盘，就可以支持更多磁盘。即使多个磁盘发生故障，只要每个镜像中至少有一个驱动器继续运行，它也会继续运行

**备份和容错是不一样的，如果提供容错的硬盘都被破坏了，如果没有备份，那么数据就丢失了。**

此外，大多数基于硬件的阵列都支持**热插拔（hot swapping）**，允许技术人员在不关闭系统电源的情况下更换故障磁盘。冷插拔 RAID 要求关闭系统电源以更换有故障的驱动器。
## 保护服务器

故障转移集群（failover cluster）：集群中的一个机器故障了，其它机器继续顶上。

![](attachments/Pasted%20image%2020241220115028.png)
## 保护电源

可以为带有 UPS 和/或发电机（generator）的电源添加容错功能。通常，UPS 在短时间内（5 到 30 分钟）提供电池供电，而发电机提供长期电力。UPS 的目标是提供足够长的电力以完成系统的逻辑关闭，或者直到发电机通电并提供稳定的电力。

## 可信恢复

可以将系统设计为在故障安全状态或故障开放状态下发生故障。
**故障安全（fail-secure）系统**：在发生故障时将默认为安全状态，从而阻止所有访问。
**故障开放（fail-open）系统**：将在打开状态下失败，并授予所有访问权限

可信恢复流程有两个部分：

1. **故障准备**：保障系统弹性和容错能力
2. **故障恢复流程**：系统能够重新启动并进入到单用户非特权状态，恢复所有受影响的文件，数据，服务等等。

通用准则（common criteria）里包括了与系统弹性和容错相关的可信恢复部分。它定义了四种类型的可信恢复：

- **手动恢复**：管理员手动执行可信恢复
- **自动恢复**：系统能够执行可信恢复活动，以针对至少一种类型的故障进行自我恢复。例如，硬件 RAID 针对硬盘驱动器的故障提供自动恢复，但不针对整个服务器的故障进行自动恢复
- **自动恢复**，无应有损失：这与自动恢复类似，因为系统可以针对至少一种类型的故障进行自我恢复。但是，它包括确保特定对象受到保护以防止其丢失的机制。防止意外丢失的自动恢复方法包括还原数据或其他对象的步骤。它可能包括其他保护机制，用于还原破裂的文件、从事务日志重建数据以及验证关键系统和安全组件的完整性
- **功能恢复**：支持功能恢复的系统能够自动恢复特定功能。此状态可确保系统能够成功完成函数的恢复，或者系统能够回滚更改以返回到安全状态
## 服务质量（QoS）

服务质量 （Quality of Service，QoS） 控制可保护负载下数据网络的可用性。

一些和QoS有关的要素：

- **带宽（bandwidth）**：网络进行通信的能力
- **延迟（Latency）**：数据包从源道目的地花费的时间
- **抖动（jitter）**：不同数据包之间的延迟变化。
- **丢包（packet loss）**：某些数据包可能会在源和目标之间丢失，需要重新传输。
- **干扰（Interference）**：电气噪声、设备故障和其他因素可能会损坏数据包的内容。
# 恢复策略

有价值的纸质保险（Valuable paper insurance）为题字、印刷和书面文件、手稿和其他印刷商业记录提供保护。**但是，它不包括对纸币和印刷安全证书的损坏。**

## 业务单元和职能优先级

做业务影响分析，确定灾难恢复的优先级，**最终产出一个按优先级顺序排列的项目清单，每个项目都有自己的风险和成本评估，以及相应的恢复目标和里程碑集。**

这又涉及到几个关键概念：

- **MTTR(mean time to recovery)**
- **MTD(maximum tolerable downtime)**
- **RTO(recovery time objective)**
- **RPO(recovery point objective)**

## 危机管理（crisis management）

**如果您的培训预算允许，为您的关键员工投资危机培训是一个好主意**。这可以确保至少一些员工知道如何正确处理紧急情况，并可以为惊慌失措的同事提供最重要的“现场”领导。

## 紧急通信

1. 当灾难发生时，组织能够进行内部和外部世界的沟通非常重要。
2. 教导员工媒体采访工作应该移交给公共事务部处理

## 工作组恢复

在设计灾难恢复计划时，请务必牢记您的目标 — **将工作组重新组织起来，使其能够在通常的工作地点恢复活动**。人们常误以为灾难恢复是纯粹的 IT 工作

## 备用站点


**冷站点（cold sites）：**

冷站点是足够大的备用设施，可以处理组织的处理负荷，并配备适当的电气和环境支持系统。

However, a cold site has no computing facilities (hardware or software) preinstalled and also has no active broadband communications links.

优点：省钱
缺点：在决定启用冷站点到冷站点能够支持运营有比较大的时间间隔。因为冷站点几乎什么都没有。



**温站点（warm sites）：**

暖站点位于热站点和冷站点之间，适合灾难恢复专业人员。它们始终包含快速建立运营所需的设备和数据电路。与热站点一样，此设备通常已预先配置并准备好运行适当的应用程序以支持组织的运营。但是，与 Hot Sites 不同的是，Warm 站点通常不包含客户端数据的副本。使温站点完全运行状态的主要要求是将适当的备份媒体传输到站点，并在备用服务器上恢复关键数据。

激活温站点通常在12个小时内。

**热站点（hot sites）：**

热站点与冷站点完全相反。在这种配置中，备份设施保持持续的工作状态，并配备齐全的服务器、工作站和通信链路，随时准备承担主要运营职责。服务器和工作站都已预先配置并加载了适当的操作系统和应用程序软件。

主站的数据周期性地复制到热站点，一旦主站点挂掉，备用热站点可以在很短的时间内投入使用。

优点：此类站点提供的灾难恢复保护级别无与伦比
缺点：很费钱

减少热站点费用的另一种方法是将热站点用作开发或测试环境。开发人员可以将数据实时复制到热站点，以用于测试目的，并提供生产环境的实时副本。这样可以让热站点为组织提供有用的服务，即使它没有主动用于灾难操作，也可以降低成本

**移动站点（mobile sites）：**

移动站点是传统恢复站点的非主流替代方案。它们通常由独立的拖车或其他易于搬迁的单元组成。这些站点包括维护安全计算环境所需的所有环境控制系统。较大的公司有时会以“飞走”的方式维护这些站点，准备通过空运、铁路、海运或地面运输将它们部署到世界各地的任何运营地点。较小的公司可能会与其当地的移动站点供应商签订合同，以根据需要提供这些服务。

移动站点通常配置为 cold 站点或 warm 站点


**云计算（cloud computing）：**

现在很多组织将云计算环境作为他们的灾难恢复选项，利用IaaS环境作为备用站点。

如果一个已经使用云环境运营的公司，并不是就不需要做灾难恢复计划了，而是需要好好利用云资源，合理的设计系统的容错性、高可用性、弹性等等。

### 互助协议

Mutual assistance agreements (MAAs), also called reciprocal agreements, are popular in disaster recovery literature but are rarely implemented in real- world practice

互助协议 （MAA），也称为互惠协议，在灾难恢复文献中很受欢迎，但在实际实践中很少实施。

根据 MAA，两个组织承诺在发生灾难时通过共享计算设施或其他技术资源来相互帮助。乍一看，它们似乎非常经济高效 — 任何组织都没有必要维护昂贵的备用处理站点（例如前面几节中描述的热站点、暖站点、冷站点和移动处理站点）

MAA的这些缺点阻止它被广泛采用：

- MAA 很难执行。
- 合作组织应彼此相对靠近，以方便员工在工作场所之间的运输
- 出于机密性考虑，企业通常不会将其数据交到他人手中。

## 数据库恢复

### Electronic Vaulting

将数据库备份批量转移到一个远程地点，这个地点可以是一个热站点，或者专门的存储库，或者是一个第三方托管的存储库。

缺点：
1. 备份恢复时，可能耗时较长
2. 发生灾难时，丢失的数据可能比较多，因为备份间隔时间比较长


如果和第三方签订electronic vaulting合同，需要考虑他们的带宽、存储容量、备份恢复时检索数据的能力等

要定期检查备份是否可用，**可以通过要求他们恢复某一天的数据的方式来判断备份的可用性**。

### Remote Journaling

可以更快速地执行数据传输。数据传输依然使用批量传输的方式进行，但他们发生得更频繁，通常每小时一次，有时更频繁。

### Remote Mirroring

在备份站点上实时同步数据。

# 恢复计划开发

## 应急响应（Emergency Response）

灾难恢复计划中应当包含重要人员在识别出灾难或灾难即将来临时应**立即遵守的简单清晰的指令**。

应急响应计划通常以**检查表**的形式放在一起，交给响应者。在设计这些检查表时，需要记住一条重要的设计原则：对检查表的**任务进行优先级安排**，最重要的任务排在第一位！

## 职员和通信（Personnel and Communications）

灾难恢复计划还应包含发生灾难时**要联系的人员名单**。通常，这包括 DRP 团队的关键成员以及在整个组织中执行关键灾难恢复任务的人员。此响应清单应包括**备用联系方式**（即寻呼机号码、移动电话号码等），以及每个角色的**备用联系人**。
## 评估

**当灾难恢复团队到达现场时，他们的首要任务之一就是评估情况**。这通常以滚动方式进行，急救人员进行简单的评估以对活动进行分类并启动灾难响应。随着事件的进展，将进行更详细的评估，以衡量灾难恢复工作的有效性并确定资源分配的优先顺序。

## 备份和离站存储

1. **完整备份**：将某个时刻的数据全部备份
2. **增量备份**：在完整备份的基础上，仅对新增、修改过的数据进行备份
3. **差异备份**：在完整备份的基础上，仅备份当前数据和完整备份的差异部分。

增量备份和差异备份的区别：在数据恢复时，增量备份需要恢复完整备份和所有增量备份，儿差异备份仅需要恢复完整备份和最后一份差异备份数据。

**磁盘到磁盘备份**：磁盘价格便宜了，现在很多采用这种方式备份。

**备份最佳实践**：

1. 系统不繁忙的时候进行，例如夜间
2. **定期备份+实时备份的方式**，防止数据丢失
3. 仅备份必要的信息
4. 测试备份的恢复流程，以防出现备份成功但是恢复失败的情况

**磁带轮换**：



## 软件托管协议

将软件源代码托管给第三方，当供应商破产后，可以避免源码丢失。

## 公用设施

组织要依靠一些公用设施来提供自身基础设施的关键要素，如电力、 水、天然气和管道服务等。因此，灾难恢复计划中应该包含联系信息和措施，以解决这些服务在灾难发生过程中出现的问题。

## 物流和供应

## 恢复与还原的比较（Recovery vs Restoration）

**恢复**：将业务操作（business）和流程（processes）恢复到可工作的状态。恢复团队仅有很少的时间来恢复业务，他们的工作是确保业务在最短的时间内恢复到可用状态，他们并不追求必须在原来的数据中心提供服务，可以是快速切换到备用站点。


**还原**：将业务设施（facility）和环境（environment）还原到可工作状态。还原要求所有状态恢复如初，还原团队有更多的时间来做这件事。


# 培训、意识和文档

与业务连续性计划一样，必须对相关人员进行培训。

- 对全体新员工进行入职培训。
- 对第一次担任灾难恢复角色的员工进行初始培训。
- 对灾难恢复团队的成员再进行详细的培训。
- 对所有其他员工进行简要的意识培训（可能是通过在线课程或者邮件的形式）。

DRP文档是及其敏感的文档，要确保合适的访问控制措施。同时，还要确保DRP团队关键成员和高管知道整个计划和高级实施细节。


要确保主站点和备用站点都有DRP纸质文档备份。

## 测试与维护

### 通读测试（read through test）

测试人员通读灾难恢复计划文档。

- 确保灾难恢复人员意识到他们的职责并定期复习知识。
- 为人员提供审查计划中过时信息的机会，并根据组织变化更新计划内容


### 结构化演练（structured walk-through）

灾难诙复团队成员聚集在一间大会议室中，不同的入扮演灾难发生时的不同 角色。

### 模拟测试

模拟测试(simulation test)与结构化演练类似。模拟测试向灾难恢复团队成员呈现情景并要 求他们做出适当的响应。与前面讨论的测试不同，其中某些响应措施随后会被测试。**这种测试可能会中断非关键的业务**活动并使用某些运营人员。

### 并行测试（parallel test）

将实际人员重新部署到备用恢复站点并实施站点启用过程。被重新部署到站点的员工，以灾难实际发生时的方式履行他们的灾难恢复职责。唯－的差别在测试不会中断主要设施的运营，这个站点仍然处理组织的日常业务。

### 完全中断测试

中断主站点的运营，转移到备用站点。测试完成后，在主站点执行恢复运营的反向过程。

### 经验教训

### 维护

灾难恢复计划是一份活的文档。随着纠织需求的变化，必须对灾难恢复计划进行 修改以适应这些变化。通过使用组织好的和协调一致的测试计划，会发现灾难恢复计划中需 要修改的地方。


------

d   c   DRP的最终目标是恢复业务的正常运行
c
d
b
c

ad   abd    组织可以选择实施BCP还是DRP，虽然建议是都实施
b
d
c
b

c
c
d
d
a

d
c   a
b
a
b







