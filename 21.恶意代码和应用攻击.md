# 重点

- 理解病毒使用的传播技术
- 解释勒索软件的威胁
- 知道反病毒软件如何检测已知的病毒
- 解释UEBA系统如何工作
- 熟悉攻击者攻击脆弱应用的各种方式
- 理解常见的web应用漏洞及防御措施
# 恶意软件

## 恶意代码的来源

略

## 病毒

与生物病毒一样，计算机病毒有两个主要功能 — 传播和有效载荷执行。

- 传播函数定义了病毒如何在系统之间传播，感染它留下的每台机器。
- 病毒的有效载荷会提供病毒编写者想到的任何恶意活动。这可能是对系统或数据的机密性、完整性或可用性产生负面影响的任何内容

### 病毒传播技术

**主引导记录病毒（Master Boot Record Viruses）**：主引导记录 （master boot record，MBR） 病毒是已知最早的病毒感染形式之一。MBR 病毒的工作原理是将系统重定向到受感染的引导扇区，该扇区在从合法引导扇区加载操作系统之前将病毒加载到内存中。**引导扇区病毒实际上会感染合法的引导扇区，并在操作系统加载过程中加载到内存中。**

**文件感染病毒（File Infector Viruses）**：Many viruses infect different types of executable files and trigger when the operating system attempts to execute them

**宏病毒（Macro Viruses）**：VBA的宏病毒

**服务注入病毒（Service Injection Viruses）**：**病毒将自己注入到可信的操作系统进程中，如svchost.exe，winlogon.exe，explorer.exe等等。**


### 病毒技术

**复合病毒（Multipartite Viruses）：** 复合病毒试图使用多种传播技术渗透只防御其中一种技术的系统。例如，病 可能通过向每个文件添加恶意代码来感染关键的COM和EXE文件，使其成为文件感染病 毒。然后，同一病毒还可能将恶意代码写入系统的主引导记录，从而使其成为引导扇区病毒。

**隐形病毒（Stealth Viruses）**：隐形病毒通过实际篡改操作系统来欺骗防病毒软件包，使其认为一切正常，从而隐藏自己。

**多态性病毒（Polymorphic Viruses）**：病毒会在传播过程中修改它的hash，以躲过杀毒。

**加密病毒（Encrypted Viruses）**：加密病毒使用加密技术，如第 6 章 “加密和对称密钥算法”中描述的技术，以避免被检测。

## 恶作剧

略

## 逻辑炸弹（Logic Bombs）

逻辑炸弹是感染系统的恶意代码对象，在发生一个或多个条件（如时间、程序启动、网站 登录、某些击键等）触发之前，它们一直处于休眠状态。

## 特洛伊木马（Trojan Horses）

一种看似善意但携带恶意的有效载荷的软件程序，有可能对系统或网络造成严重破坏。

**Remote access Trojans (RATs)** are a subcategory of Trojans that open backdoors in systems that grant the attacker remote administrative control of the infected system

其他木马旨在从受感染的系统窃取计算能力，用于挖掘比特币或其他加密货币。这种对计算能力的使用为攻击者带来了经济回报。执行加密货币挖掘的特洛伊木马和其他恶意软件也称为加密恶意软件（cryptomalware）。

**僵尸网络（Botnets）**：被黑客控制的许多主机组成的一个网络，他们通常被用来发起DDoS攻击。

**木马通常通过下载和安装包含木马的软件来传播**。**这些软件往往是通过欺骗、社交工程等手段诱使用户下载和安装的**。而病毒是通过文件传输、邮件附件、移动存储设备等渠道传播。
## 蠕虫（worms）

蠕虫对网络安全构成重大风险。它们包含与其他恶意代码对象相同的破坏性潜力，但增加了一个变化 — **它们无需任何人工干预即可自行传播**

## 间谍软件和广告软件

**间谍软件（Spyware）** 会监控您的操作，并将重要详细信息传输到监视您活动的远程系统

**广告软件（Adware）** 虽然在形式上与间谍软件非常相似，但用途不同。它使用多种技术在受感染的计算机上显示广告


间谍软件和广告软件都属于一类称为**潜在有害程序 （potentially unwanted programs，PUP）** 的软件，用户可能同意在其系统上安装该软件，然后执行用户不希望或授权的功能

## 勒索软件

支付赎金在某些地区可能是违法行为。
## 恶意脚本

略

## 0-day攻击

零日漏洞（zero-day vulnerabilities）：黑客发现的安全漏洞，这些漏洞尚未被安全社区彻底解决。

# 防御恶意软件

## 反病毒软件

**基于签名的（signature-based detection）**：基于恶意软件的文件hash值，将hash值与恶意软件库中的hash值做比较
**基于行为的/启发式检测（heuristic mechanisms）**：监测软件是否出现可以行为，例如试图提升权限级别、掩盖其电子轨迹以及更改不相关或操作系统文件

## 完整性监控

其他安全包（如文件完整性监控工具）也提供辅助防病毒功能。这些工具旨在提醒管理员注意未经授权的文件修改。它通常用于检测 Web 服务器篡改和类似攻击，但如果关键系统可执行文件（如 command），它也可能会提供一些病毒感染警告。**这些系统通过维护系统上存储的所有文件的哈希值数据库来工作**

## 高级威胁保护

**端点检测和响应 （Endpoint detection and response，EDR） 软件超越了传统的防恶意软件保护，有助于保护端点免受攻击。**

EDR具有的一些特殊能力：

- 分析端点内存、文件系统和网络活动以查找恶意活动的迹象
- 自动隔离可能的恶意活动以遏制潜在的损害
- 与威胁情报源集成，以实时了解互联网上其他位置的恶意行为
- 与其他事件响应机制集成，以自动化响应工作

许多安全供应商将 EDR 功能作为托管服务产品提供，他们提供安装、配置和监控服务，以减轻客户安全团队的负担。这些托管的 EDR 产品称为托管检测和响应 （managed detection and response，MDR） 服务。


此外，**用户和实体行为分析 （user and entity behavior analytics，UEBA）** 软件特别关注端点和其他设备上基于用户的活动，构建每个人正常活动的档案，然后突出显示可能表明潜在危害的与该档案的偏差。UEBA 工具与 EDR 功能的不同之处在于，**UEBA 侧重于用户分析，而 EDR 侧重于端点**。

# 应用程序攻击

## 缓冲区溢出

当开发人员未正确验证用户输入以确保其大小合适时，就会存在缓冲区溢出漏洞。

- 用户输入的值不能超过将保存它的任何缓冲区的大小（例如，将 10 个字母的单词转换为 5 个字母的字符串变量）。
- 用户不能为将保存该值的变量类型输入无效值（例如，将字母输入到数值变量中）。
- 用户无法输入将导致程序在其指定参数之外运行的值（例如，用“maybe”回答“yes”或“no”问题）。

未能执行简单检查以确保满足这些条件可能会导致缓冲区溢出漏洞，这可能会导致系统崩溃，甚至允许用户执行 shell 命令并获得对系统的访问权限
## 检查时间到使用时间

检查时间到使用时间（TOCTTOU 或 TOC/TOU）攻击通常称为条件竞争

time of check和time of use之间的差值过大，导致攻击者可以可以在use之前替换将要使用的客体。
## 后门

后门是未记录的命令入口，允许了解后门的个人绕过正常的访问限制

## 特权提升（privilege Escalation）和 Rootkit

一旦攻击者在系统上站稳脚跟，他们通常会迅速转向第二个目标 — 将他们的访问权限从他们可能已经攻破的普通用户帐户扩展到更全面的管理访问权限。他们通过参与权限提升攻击来做到这一点。

攻击者发动权限提升攻击的常见方式之一是使用Rootkit。Rootkit 可在 Internet 上免费获得，并利用各种操作系统中的已知漏洞。
# 注入漏洞

## SQL注入

### 基于内容的盲注

### 基于时间的盲注

# 代码注入

sql注入是代码注入的一个特殊案例，还有以下这些例子：

- LDAP注入
- XML注入
- DLL注入
- XSS攻击

# 命令注入


# 利用授权漏洞

## 不安全的直接对象应用（IDOR）

## 目录遍历

## 文件包含

- 本地文件包含
- 远程文件包含

# 利用Web应用漏洞

## XSS

- 反射型xss
- 存储型xss
- DOM xss
## csrf/xsrf

## ssrf

## 会话劫持（session hijacking)

当恶意的个人拦截授权用户和资源之间的部分通信，然后使用劫持技术接管会话并假冒 授权用户的身份时，即发生了会话劫持攻击。

- 捕获客户端和服务器之间身份认证的详细信息，并用这些信息假冒客户端的身份。
- 诱使客户端认为攻击者的系统就是服务器，在客户端与服务器建立合法连接时充当中介，然后断开客户端的连接。
- 使用未正确关闭连接的用户的cookie数据访问Web应用程序，或使用设计糟糕的未 正确管理身份认证cookie 的应用程序的cookie数据访问 Web应用程序。

# 应用安全控制

## 输入验证

## Web应用防火墙（WAF）

## 数据库安全

1. 参数化查询和存储过程（Parameterized Queries and Stored Procedures）
2. 混淆和伪装（Obfuscation and Camouflage）
	1. 数据最小化（Data minimization）是最好的防御措施
	2. Tokenization：标记化将可能直接泄露个人身份的个人标识符替换为其它的唯一标识符
	3. Hashing：哈希使用加密哈希函数将敏感标识符替换为不可逆的替代标识符。在**对这些值进行哈希处理之前，用随机数对这些值进行加盐，使这些哈希值能够抵抗一种称为彩虹表攻击的攻击。**

## 代码安全

**代码签名**：代码签名为开发人员提供了一种向最终用户确认其代码真实性的方法。开发人员通过加 密函数用自己的私钥对代码进行数字签名，之后浏览器可以使用开发人员的公钥来验证签名， **确保代码合法且未被非授权的人修改**。

**代码重用**：

**软件多样性**：安全专业人员应该注意组织中依赖于单个源代码、二进制可执行文件或编译器的位置。虽然不可能消除所有这些依赖项，但跟踪它们是维护安全代码库的关键任务 之一

**代码仓库**：代码仓库是用于存储和管理应用程序源代码的集中位置。
	1. 版本控制
	2. 代码重用
	3. 避免死代码，即无人维护的代码

**完整性度量**：代码完整性度屋使用加密哈希函数来验证发布到生产 环境中的代码是否与先前批准的代码相匹配。哈希值中的任何偏差都表明代码被有意或无意 修改过，需要在发布之前进一步调查。

**应用程序韧性（Application Resilience）**：
	- Scalability：可扩展性表示，应用程序的设计应该使它们所需的计算资源可以逐步添加以支持不断增长的需求。
	- Elasticity：弹性比可扩展性更进一步，它表示应用程序应该能够在必要时自动配置资源以进行扩展，然后在不再需要这些资源时自动取消这些资源的愿景以减少容量（和成本）。

你可以将Elasticity视为具有可以根据需要scale up或者scale down的能力。
# 安全编码实践

- 源码注释
- 错误处理
- 硬编码凭证：不要硬编码凭证信息
- 内存管理
	- 资源耗尽：例如内存泄漏可能导致资源耗尽。
	- 指针解引用：如果指针指向空地址，进行指针解引用时，就会抛出空指针异常



----
d
c b
c
a
b

b
d
c
a
d

b
c
a
ad   abd
b

a 
a b
a d
d 
b c


