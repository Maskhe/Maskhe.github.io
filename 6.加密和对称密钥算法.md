# 1.加密基础
## 1.1 密码学的目标

- **保密性**：机密性可确保数据在三种不同情况下保持私密：静态时、传输中和使用时。
- **完整性**：对原始数据做摘要后，对摘要进行加密，数据接收方可以通过验证摘要的方式确认数据未被篡改，这种技术叫做数字签名，依赖摘要算法、非对称加密算法。
- **身份认证**：利用非对称加密算法实现
- **不可抵赖**：非对称加密算法实现

## 1.2 密码学的概念

**明文（plaintext）**：通常在加密算法公式里用P代表。
**密文（ciphertext）**：在加密算法公式中用C代表。
**加密（encrypt）**：把明文转换为密文
**解密（decrypt）**：把密文转换为明文

加密算法依赖密钥（keys）来确保安全，密钥是一个很大的二进制数，每种加密算法都有特定的密钥空间（key space），密钥空间大小由比特位（bit size）确定，也就是密钥的二进制位数。

## 1.3 密码数学

- 与运算
- 或运算
- 异或运算
- 模运算
- 非运算
- **单向函数（One-Way Functions）**：A经过运算得到B，但无法逆向从B得到A。
- **Nonce**：一个随机数，典型例子：初始化向量（IV）。
- **零知识证明（Zero-Knowledge Proof）**：零知识证明出现在密码学中，当一个人想要证明对事实（例如密码或密钥）的了解，而没有实际向另一个人披露该事实时。
- **分割知识（Split Knowledge）**：将职责分离和双人控制融合的做法称为分割知识，典型例子是密钥托管。一个8位密码被4个人分别记住2位，即4个人同时操作才能执行登录或访问操作。M of N控制要求，N人数中的M个同事在场才能执行高安全任务。
- **代价函数（Work Function)**：对一个加密系统施展一次完整的蛮力攻击所需要的代价是代价函数的含义

## 1.4 密码

**代码与密码**：代码有时可以起到保密的作用，但是并不一定能提供保密性保护。密码则始终要隐藏消息的真实含义。代码作用于单词和短语而密码作用于字符和位。
**移位/转置密码（Transposition ciphers）**：转置密码使用加密算法重新排列明文消息的字母，形成密文消息。
**替换密码（Substitution Ciphers）**：替换密码将明文消息中的每个字符或位替换为其它字符或位。
**单次密本（One-Time Pads）**：一个密本一次只能用于加密一条消息，密钥是和消息一样长的，因为每加密一个字符都要随机从单词密本中选一个值进行加密
**运动密钥密码（Running Key Ciphers）**：单次密本的麻烦之处在于，密钥是随机的，加解密双方需要物理传递密钥，否则无法解密，而运动密钥密码则解决了这个问题，加解密双方可以约定密钥来自于某本书的某个章节的某个段落，这样，就不用物理传递密钥。
**块密码（block ciphers）**：在某个消息块上执行加密，在同一时间对整条消息进行加密，移位密码就是块密码的案例。
**流密码（stream ciphers）**：一次在消息的一个字符或者位上运行，凯撒密码就是流密码。流密码还可以用作一种分组密码。在此类操作中，有一个缓冲区，该缓冲区将实时数据加密为块并传输给接收者
**混淆和扩散（Confusion and Diffusion）**：一种密码先是经过某种替换，再进行移位确定密文，在这个过程中，替换就是混淆，移位就是扩散。

# 2. 现代密码学

## 2.1 加密密钥

早期人们认为需要将加密算法保密以确保加密算法的安全性，后来，人们通过密钥保密，算法公开来确保安全性。

一些密钥管理的安全实践：

- 始终安全地存储密钥，如果您必须通过网络传输密钥，请以保护密钥免遭未经授权的泄露的方式传输。
- 密钥的生成尽可能地随机，且占用更大的密钥空间
- 不需要密钥时，安全地销毁密钥

## 2.2 对称加密算法

对称加密又叫私钥加密。对称加密的缺点：

- 密钥分发问题
- 对称加密无法提供不可否认性
- 算法缺乏伸缩性：当通信规模巨大的时候，无法确保两个个体之间的通信是加密的（如果共享一个密钥的话）
- 密钥必须经常重新生成：每当有参与者离开通信的时候，都需要重新更换密钥，避免被人窃密。

## 2.3 非对称密钥算法

又叫公钥加密。非对称加密相对于对称加密的一些增强：

- 添加新用户时只需要生成一对公私钥
- 便于从非对称系统移除用户
- 只需要在用户失信的情况下重新生成私钥，一个用户离开社区只需要让这个用户的私钥失效就行
- 非对称加密可提供隐私性、完整性、不可否认性、身份认证
- 密钥分发简单，用户加入通信，只需要把自己的公钥发送给系统，
- 不需要预先建立通信关联（再理解一下）

公钥加密法的缺点是速度慢，所以很多系统在设计时都是通过非对称加密法交换一个对称加密密钥，后续直接使用对称加密算法进行通信，https协议就是这样的加密通信机制。

## 2.4 散列算法

略。
# 3. 对称加密

## 3.1 加密模式

### 3.1.1 Electronic Code Book Mode（ECB）

电子密码本 （ECB） 模式是最容易理解且最不安全的模式。每次算法处理 64 位区块时，它都会简单地使用所选的密钥对区块进行加密，所以如果对同样地明文区块加密，会得到相同地密文区块，存在被猜解的可能。

### 3.1.2 Cipher Block Chaining Mode（CBC）

在密码块链接 （CBC） 模式下，每个未加密的文本块在加密之前都会与紧接在它前面的密文块进行 XOR 运算。第一个块，是用一个初始化向量（IV）进行异或的。

CBC模式会导致错误传播，如果其中一个块加密出错，后面的内容都会出错。

### 3.1.3 Cipher Feedback Mode（CFB）

密码反馈 （CFB） 模式是 CBC 的流式密码版本。换句话说，CFB 对实时生成的数据进行操作。但是，它不是将消息分解为块，而是使用相同块大小的内存缓冲区。当缓冲区变满时，它会被加密，然后发送给收件人。

### 3.1.4 Output Feedback Mode（OFB）

在输出反馈 （OFB） 模式下，密码的运行方式与在 CFB 模式下的操作方式几乎相同。但是，OFB 不是对前一个密文块的加密版本进行 XOR 运算，而是与种子值进行 XOR 运算。第一个种子值是通过IV生成的，后续的种子值则是IV经过算法转换后的值，可以看出来，如果前一次加密失败，失败是不会传播到后续的加密中的。

### 3.1.5 Counter Mode（CTR）

以计数器(CTR)模式运行的 DES 使用了与 CFB OFB 模式类似的流密码。但是， CTR式不是根据以前的种子值结果为每次加密/解密运算创建种子值，而是利用一个简单的计数器创建种子值。与 OFB 模式一样， CTR 模式不会传播错误。

而且，CTR模式因为不依赖前一个块加密的任何信息，所以每个块的加密、解密都可以独立进行，所以它很适合应用并行计算。

### 3.1.6 Galois/Counter Mode（GCM）

Galois/Counter Mode （GCM） 采用标准的 CTR 加密模式，并在其中添加了数据真实性控制，为接收者提供所接收数据完整性的保证。这是通过向加密过程添加身份验证标签来完成的。

### 3.1.7 Counter with Cipher Block Chaining Message Authentication Code Mode（CCM）

与GCM类似，密码块链接消息认证码（CBC-MAC）算法替代标记实现身份验证。

## 3.2 DES (Data Encryption Standard)，数据加密标准

64位块密码，其中秘钥长度为56位，剩余8位包含奇偶校验信息。

被认为不再安全。

## 3.3 3DES（Triple DES）

3DES在DES的基础上多做了两次加密，安全性比DES有所提升，但是也被认为不在适用。

3DES有几个变种：

- DES-EEE3：使用三个秘钥给明文加密三遍，秘钥长度168。
- DES-EDE3：使用三个秘钥，用一次解密运算替换了第二次加密运算，秘钥长度168。
- DES-EEE2：使用两个秘钥，其中一个秘钥加密了两次，秘钥长度112。
- DES-EDE2：使用两个秘钥，其中一个秘钥执行解密运算，秘钥长度112。

## 3.4 IDEA（International Data Encryption Algorithm）

DES被认为不安全的主要原因是密钥长度不足，所以IDEA增加了密钥长度到128位，它也是对64位的块进行加密。

该算法虽然是专利，但因专利到期可无限制使用，常用于PGP（Pretty Good Privacy, 良好隐私）安全邮件中。

## 3.5 Blowfish

- 可变长度密钥：32-448位。
- 处理64位块
- 免费使用
## 3.6 skipjack

- 秘钥长度为80位
- 处理64位块
- 常用于政府机构，因为秘钥受NIST和财政部把控。
- 支持密钥托管

## 3.7 Rivest Ciphers

### 3.7.1 RC4

- **被认为不安全**。
- 可变密钥长度：40-2048位
- 曾用在WPA、SSL、TLS中

### 3.7.2 RC5

- 可变密钥长度：0-2040
- 可变块长度：32 64 128

RC5受到暴力破解影响，破解一个64密钥加密的RC5密文花费4年。

### 3.7.3 RC6

是RC5的下一个版本


- 可变密钥长度：128  192 256 
- 128位块
- 未广泛使用

## 3.8 AES

- 可变密钥长度：128  192 256
- 128位块

## 3.9 CAST

- CAST-128 使用 12 轮或 16 轮 Feistel 网络加密，在 64 位纯文本块上，密钥大小为 40 位和 128 位。
- CAST-256 在 128 位明文块上使用 48 轮加密，密钥大小为 128、160、192、224 或 256 位

## 3.10 对称加密算法对比

这是考试重点


![](attachments/Pasted%20image%2020250904160757.png)
## 3.11 对称密钥管理

秘钥管理实践包括密钥的创建、分发、存储、销毁、恢复和托管的保护措施。

### 3.11.1 创建和分发对称密钥

- **线下分发**：一方向另一方提供一张包含密钥的纸或存储介质。
- **公钥加密**：TLS交换密钥则使用了公钥加密方式。
- **Diffie-Hellman**：可参考后续章节。

### 3.11.2 存储和销毁

- 绝不将密钥和加密数据保存在一个系统里
- 敏感密钥，可以考虑一人持有一半（这就是基于分割知识原则）

当掌管某个密钥的人离职或不再允许访问该密钥时，应该销毁密钥，并使用新密钥加密数据。

密钥的存储方式：

- 基于软件的存储：可能应为软件缺陷导致密钥丢失
- 基于硬件的存储：更贵、更安全。HSM

### 3.11.3 密钥托管和恢复

密码是一种强有力的工具。与大多数工具一样，它不仅可以用于诸多有益目的，同时也可以用来达到恶意企图。面对密码工具的爆炸性增长，各国政府提出了使用密钥托管系统的主张。 这些系统允许政府在有限的情况下(如按照法院的命令)从一个中央存储设施获取用于某一特定通信的密码密钥。

在过去十年中，提出了两种主要的密钥托管方法：

- **公平密码系统（Fair Cryptosystems）**：在这种托管方法中，通信中使用的密钥被分成两个或多个部分，每个部分都交给独立的第三方。这些部分本身都是无用的，但它们可以重新组合以获得密钥。当政府获得访问特定密钥的合法授权时，它会向每个第三方提供法院命令的证据，然后重新组装密钥。
- **受托加密标准（Escrowed Encryption Standard）**：这种托管方法为政府或其他授权代理提供了一种解密密文的技术手段。

除了政府使用，在组织中使用密钥托管和恢复机制也是有益的，例如某个人离职了，企业想要获取他之前加密的数据，此时获取他之前的密钥就很有必要，可以基于知识分割原则来恢复密钥。M of N，M个人同意恢复密钥，则可以成功恢复。

## 3.12 密码生命周期

摩尔定律对计算能力发展趋势 的预测己被普遍接受;它指出，最先进微处理器的处理能力大约每两年会提高一倍。这意味着， 处理器迟早会达到随意猜出通信所用加密密钥的强度等级。

所以要合理的选择加密算法，确保受保护信息不被泄露，但是也需要根据业务重要程度选择加密方式。



